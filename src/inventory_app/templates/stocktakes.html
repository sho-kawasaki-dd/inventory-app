{% extends "layout.html" %}
{% block content %}
<h1>Stocktakes</h1>
<form id="new-stocktake-form">
  <input type="text" name="title" placeholder="Title" required />
  <button class="btn primary" type="submit">Create stocktake from current stock</button>
</form>

<h2>List</h2>
<table id="stocktakes-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Lines</th>
      <th>Diffs</th>
      <th>Status</th>
      <th></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
{% endblock %}
{% block scripts %}
<script>
  window.InventoryApp.loadStocktakes();
  document.getElementById('new-stocktake-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const payload = { title: fd.get('title') };
    const res = await window.InventoryApp.api('/api/stocktakes', { method: 'POST', body: JSON.stringify(payload) });
    const data = await res.json();
    window.location.href = `/stocktakes/${data.id}`;
  });
</script>
{% endblock %}
